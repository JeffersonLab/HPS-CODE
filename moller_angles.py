#!/usr/bin/env python
import sys
from ROOT import gROOT, gStyle, TFile, TTree, TChain, TMVA, TCut, TCanvas, gDirectory, TH1, TGraph
gStyle.SetOptFit(1)
inFile = TFile(sys.argv[2])
#outFile = TFile(sys.argv[1]+".root","RECREATE")
events = inFile.Get("ntuple")

c = TCanvas("c","c",1200,900);
c.Print(sys.argv[1]+".pdf[")

c.Divide(4,2)
for i in xrange(1,5):
    energy=0.3+(i-1)*0.1
    events.Draw("acos(topPZ/topP)-acos(1-0.511e-3*(1/topP-1/1.056)):atan2(topPX,topPY)>>hnew(30,-1,1,50,-0.01,0.01)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(topP-{0})<0.05".format(energy),"goff,colz")
    hnew = gDirectory.Get("hnew")
    c.cd(i)
    hnew.DrawCopy("colz")
    hnew.FitSlicesY()
    hnew_1 = gDirectory.Get("hnew_1")
    c.cd(i+4)
    hnew_1.GetYaxis().SetRangeUser(-0.005,0.005)
    hnew_1.Fit("pol1","","",-0.4,0.4)
    hnew_1.DrawCopy()
c.Print(sys.argv[1]+".pdf","Title:top_etheta")

c.Clear()
c.Divide(4,2)
for i in xrange(1,5):
    energy=0.3+(i-1)*0.1
    events.Draw("acos(botPZ/botP)-acos(1-0.511e-3*(1/botP-1/1.056)):atan2(botPX,-botPY)>>hnew(30,-1,1,50,-0.01,0.01)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(botP-{0})<0.05".format(energy),"goff,colz")
    hnew = gDirectory.Get("hnew")
    c.cd(i)
    hnew.DrawCopy("colz")
    hnew.FitSlicesY()
    hnew_1 = gDirectory.Get("hnew_1")
    c.cd(i+4)
    hnew_1.GetYaxis().SetRangeUser(-0.005,0.005)
    hnew_1.Fit("pol1","","",-0.4,0.4)
    hnew_1.DrawCopy()
c.Print(sys.argv[1]+".pdf","Title:bot_etheta")

#c.Clear()
#c.Divide(4,2)
#for i in xrange(1,5):
    #energy=0.3+(i-1)*0.1
    #events.Draw("topTrkZ0:topPY/topP>>hnew(100,0.01,0.06,100,-1,1)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topP-{0})<0.05".format(energy),"goff,colz")
    #hnew = gDirectory.Get("hnew")
    #c.cd(i)
    #hnew.DrawCopy("colz")
    #hnew.FitSlicesY()
    #hnew_1 = gDirectory.Get("hnew_1")
    #c.cd(i+4)
    #hnew_1.GetYaxis().SetRangeUser(-0.1,0.1)
    #hnew_1.Fit("pol1","","",0.02,0.04)
    #hnew_1.DrawCopy()
#c.Print(sys.argv[1]+".pdf","Title:top_yz")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("topTrkZ0:topPY/topP>>hnew(100,0,0.1,100,-1,1)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(topPX/topP)<0.01","colz")
hnew = gDirectory.Get("hnew")
hnew.FitSlicesY()
hnew_1 = gDirectory.Get("hnew_1")
c.cd(2)
hnew_1.Draw()
hnew_1.Fit("pol1","","",0.025,0.04)
hnew_1.GetYaxis().SetRangeUser(-0.2,0.2)
c.Print(sys.argv[1]+".pdf","Title:top_yz")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("botTrkZ0:botPY/botP>>hnew(100,-0.1,0,100,-1,1)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(botPX/botP)<0.01","colz")
hnew = gDirectory.Get("hnew")
hnew.FitSlicesY()
hnew_1 = gDirectory.Get("hnew_1")
c.cd(2)
hnew_1.Draw()
hnew_1.Fit("pol1","","",-0.04,-0.025)
hnew_1.GetYaxis().SetRangeUser(-0.2,0.2)
c.Print(sys.argv[1]+".pdf","Title:bot_yz")

#c.Clear()
#c.Divide(1,2)
#c.cd(1)
#events.Draw("topTrkD0:topPX/topP>>hnew(100,-0.05,0.05,100,-2,2)","abs(uncM*1.056/uncP-0.033)<0.003","colz")
#hnew = gDirectory.Get("hnew")
#hnew.FitSlicesY()
#hnew_1 = gDirectory.Get("hnew_1")
#c.cd(2)
#hnew_1.Draw()
#hnew_1.Fit("pol1","","",-0.02,0.02)
#hnew_1.GetYaxis().SetRangeUser(-0.2,0.2)
#c.Print(sys.argv[1]+".pdf","Title:top_xz")

#c.Clear()
#c.Divide(1,2)
#c.cd(1)
#events.Draw("botTrkD0:botPX/botP>>hnew(100,-0.05,0.05,100,-2,2)","abs(uncM*1.056/uncP-0.033)<0.003","colz")
#hnew = gDirectory.Get("hnew")
#hnew.FitSlicesY()
#hnew_1 = gDirectory.Get("hnew_1")
#c.cd(2)
#hnew_1.Draw()
#hnew_1.Fit("pol1","","",-0.02,0.02)
#hnew_1.GetYaxis().SetRangeUser(-0.2,0.2)
#c.Print(sys.argv[1]+".pdf)","Title:bot_xz")

c.Clear()
c.Divide(4,2)
for i in xrange(1,5):
    energy=0.3+(i-1)*0.1
    events.Draw("topTrkD0:topPX/topP>>hnew(100,-0.05,0.05,100,-2,2)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(topP-{0})<0.05".format(energy),"goff,colz")
    hnew = gDirectory.Get("hnew")
    c.cd(i)
    hnew.DrawCopy("colz")
    hnew.FitSlicesY()
    hnew_1 = gDirectory.Get("hnew_1")
    c.cd(i+4)
    hnew_1.GetYaxis().SetRangeUser(-0.5,0.5)
    hnew_1.Fit("pol1","","",-0.01,0.01)
    hnew_1.DrawCopy()
c.Print(sys.argv[1]+".pdf","Title:top_xz")

c.Clear()
c.Divide(4,2)
for i in xrange(1,5):
    energy=0.3+(i-1)*0.1
    events.Draw("botTrkD0:botPX/botP>>hnew(100,-0.05,0.05,100,-2,2)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(botP-{0})<0.05".format(energy),"goff,colz")
    hnew = gDirectory.Get("hnew")
    c.cd(i)
    hnew.DrawCopy("colz")
    hnew.FitSlicesY()
    hnew_1 = gDirectory.Get("hnew_1")
    c.cd(i+4)
    hnew_1.GetYaxis().SetRangeUser(-0.5,0.5)
    hnew_1.Fit("pol1","","",-0.01,0.01)
    hnew_1.DrawCopy()
c.Print(sys.argv[1]+".pdf","Title:bot_xz")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("topTrkD0:topP>>hnew(100,0,1,100,-1,1)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(topPX/topP)<0.01","colz")
hnew = gDirectory.Get("hnew")
hnew.FitSlicesY()
hnew_1 = gDirectory.Get("hnew_1")
c.cd(2)
hnew_1.Draw()
hnew_1.Fit("pol1","","",0.4,0.7)
hnew_1.GetYaxis().SetRangeUser(-0.5,0.5)
c.Print(sys.argv[1]+".pdf","Title:top_xp")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("botTrkD0:botP>>hnew(100,0,1,100,-1,1)","abs(uncM*1.056/uncP-0.033)<0.003&&abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(botPX/botP)<0.01","colz")
hnew = gDirectory.Get("hnew")
hnew.FitSlicesY()
hnew_1 = gDirectory.Get("hnew_1")
c.cd(2)
hnew_1.Draw()
hnew_1.Fit("pol1","","",0.4,0.7)
hnew_1.GetYaxis().SetRangeUser(-0.5,0.5)
c.Print(sys.argv[1]+".pdf","Title:bot_xp")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("(uncM*1.056/uncP):atan2(topPY-botPY,topPX-botPX)>>hnew(100,0,3,100,0.03,0.04)","abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(topP-botP)<0.1","colz")
hnew = gDirectory.Get("hnew")
hnew.FitSlicesY()
hnew_1 = gDirectory.Get("hnew_1")
c.cd(2)
hnew_1.Draw()
hnew_1.Fit("pol1","","",1,2)
hnew_1.GetYaxis().SetRangeUser(0.03,0.04)
c.Print(sys.argv[1]+".pdf","Title:m_phi")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("(uncM*1.056/uncP):topP-botP>>hnew(100,-1,1,100,0.03,0.04)","abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(atan2(topPY-botPY,topPX-botPX)-TMath::Pi()/2)<0.1","colz")
hnew = gDirectory.Get("hnew")
hnew.FitSlicesY()
hnew_1 = gDirectory.Get("hnew_1")
c.cd(2)
hnew_1.Draw()
hnew_1.Fit("pol1","","",-0.4,0.4)
hnew_1.GetYaxis().SetRangeUser(0.03,0.04)
c.Print(sys.argv[1]+".pdf","Title:m_theta")

c.Clear()
c.Divide(1,2)
c.cd(1)
events.Draw("uncPY:uncPX>>hnew(100,-0.01,0.01,100,-0.01,0.01)","abs(topTrkT-botTrkT)<3&&abs(uncPY)<0.005&&abs(uncPX)<0.005&&abs(uncM*1.056/uncP-0.033)<0.003","colz")
c.cd(2)
events.Draw("uncM:uncP>>(100,0.9,1.15,100,0.025,0.04)","","colz")
c.Print(sys.argv[1]+".pdf)","Title:vtx")

#c.Print(sys.argv[1]+".pdf]")
